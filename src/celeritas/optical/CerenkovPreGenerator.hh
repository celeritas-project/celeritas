//----------------------------------*-C++-*----------------------------------//
// Copyright 2024 UT-Battelle, LLC, and other Celeritas developers.
// See the top-level COPYRIGHT file for details.
// SPDX-License-Identifier: (Apache-2.0 OR MIT)
//---------------------------------------------------------------------------//
//! \file celeritas/optical/CerenkovPreGenerator.hh
//---------------------------------------------------------------------------//
#pragma once

#include "celeritas/phys/ParticleTrackView.hh"

#include "CerenkovData.hh"
#include "CerenkovDndxCalculator.hh"
#include "OpticalDistributionData.hh"
#include "OpticalPropertyData.hh"

namespace celeritas
{
//---------------------------------------------------------------------------//
/*!
 * Sample the number of Cerenkov photons to be generated by
 * \c CerenkovGenerator and populate \c OpticalDistributionData values using
 * Param and State data.
 * \code
    CerenkovPreGenerator pre_cerenkov(particle_view,
                                      step_collector.get(tid),
                                      optical_generator_data);
    if (pre_cerenkov(rng))
    {
        CerenkovGenerator cerenkov_gen(... , optical_generator_data);
        cerenkov_gen(rng);
    }
 * \endcode
 */
class CerenkovPreGenerator
{
  public:
    // Construct with particle and material data
    CerenkovPreGenerator(ParticleTrackView particle_view,
                         NativeCRef<OpticalPropertyData> const& properties,
                         NativeCRef<CerenkovData> const& shared,
                         OpticalMaterialId mat_id,
                         OpticalStepCollectorData optical_step);

    // Return a populated distribution data for the Cerenkov Generator
    template<class Generator>
    OpticalDistributionData CELER_FUNCTION operator()(Generator& rng);

  private:
    ParticleTrackView particle_view_;
    OpticalMaterialId mat_id_;
    OpticalStepCollectorData step_collector_data_;
    CerenkovDndxCalculator dndx_calculator_;
};

//---------------------------------------------------------------------------//
}  // namespace celeritas
